define("ps_banner",["ps_model","ps_view","jquery","ps_helper","ps_store","ps_popup"],function(){var e=arguments[0],n=arguments[1],a=arguments[2],s=arguments[3],r=arguments[4],t=arguments[5];return globals={is_page_rendered:!1,store:new r("ps_banner")},callables={format_banner:function(){var e=this,n={},a={},r=function(e,r){n[e]=n[e]||[],a[e]=a[e]||[],s.in_array(r.order,a[e])||(a[e].push(r.order),n[e].push(r))};return e.banner.is_loading||e.banner.list.forEach(function(n){r(n.promo_for,n),"home"!=n.promo_for&&e.configs.banner.products_to_home&&r("home",n)}),n},update_banner_status:function(e){if(globals.store.store_exists("banner_status")){var n=globals.store.store_fetch("banner_status");s.in_array(e.id,n.loaded)||globals.store.store_list_push("banner_status","loaded",e.id),globals.store.store_update("banner_status","active",e.id)}else globals.store.store_update("banner_status",{loaded:[e.id],active:e.id});return globals.store.store_fetch("banner_status")},read_more:function(e,a){t.modal.open("banner"+a,{header:e.banner.list[a].title,body:function(s){n.render(s,"banner_modal_body",{replace:!1,data:{item:e.banner.list[a]}})},modal_class:"banner"})}},{activate:function(s,r){var t=callables.update_banner_status(r);if(!globals.is_page_rendered){globals.is_page_rendered=!0;var i=a(".ps_js-page_"+r.page);n.render(i,"banner",{replace:!1,data:{banner:{list:[],is_loading:!0,status:t},side_banner:{list:[],is_loading:!0},configs:{}},computed:{formatted_banner:callables.format_banner,banner_length:function(){var e=this,n={};return e.banner.status.loaded.forEach(function(s){var r=e.formatted_banner[s];a.isArray(r)?n[s]=r.length:n[s]=0}),n},is_banner_active:function(){var e=this,n={};return e.banner.status.loaded.forEach(function(a){n[a]=a==e.banner.status.active}),n},side_banner_length:function(){var e=this,n=e.side_banner;return a.isPlainObject(n)&&a.isArray(n.list)?n.list.length:0}},mounted:function(){var n=this;e.view_data({success:function(s){n.configs=s.configs,e.update_page_rendered(r.page),a(n.$el).find(".ps_js-main").length>0&&e.plugin({success:function(e){n.banner.list=e.list,n.banner.is_loading=!1}},"banner"),a(n.$el).find(".ps_js-side").length>0&&e.plugin({success:function(e){n.side_banner.list=e.list,n.side_banner.is_loading=!1}},"side banner"),a(n.$el).on("click",".ps_js-banner_read_more",function(){callables.read_more(n,a(this).attr("data-index"))})}},["configs"])}})}}}});