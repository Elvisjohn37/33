define("ps_games_template",["ps_view","ps_model","ps_language","ps_popup","ps_store"],function(){var e=arguments[0],t=arguments[1],s=arguments[2],i=arguments[3],a=arguments[4],n={store:new a("ps_games_template")},r={gameName_as_key:function(e){return ps_helper.replace_all(ps_helper.to_alpha_num(e.toLowerCase())," ","")},game_preview_info:function(e){return n.store.store_exists(e)||n.store.store_update(e,{is_shown:!1,is_rendered:!1,is_mounted:!1,is_hide:!1}),n.store.store_fetch(e)},game_preview_modal:function(t,s,a){var o="game_preview_"+s,_=r.game_preview_info(o);i.modal.open(o,{modal_class:"game_preview_root",body:function(r){e.render(r,"game_preview_modal",{replace:!1,data:{game_key:s,game:t,modal_info:_,is_video_ended:!1,is_video_playing:!1},computed:{has_video:function(){var e=this;return!ps_helper.empty(e.game.videoReference)},is_loaded:function(){var e=this,t=e.modal_info.is_shown,s=e.modal_info.is_rendered,i=e.modal_info.is_mounted;return t&&s&&i},items:function(){var e=this,t=[];e.has_video&&t.push({type:"video",src:e.game.videoReference});for(var s=1;s<=3;s++)t.push({type:"image",src:e.game_key+"_"+s});return t},carousel_pause:function(){var e=this;return e.is_loaded?e.modal_info.is_hide?0:e.has_video?e.is_video_ended&&!e.is_video_playing?0:1:0:0},is_video_stop:function(){var e=this;return e.modal_info.is_hide&&e.has_video}},watch:{is_loaded:function(e){var t=this;e&&t.$nextTick(t.events)},is_video_stop:function(e){var t=this,s=$(t.$el).find(".ps_js-media_youtube");e&&s.trigger("media_stop")}},mounted:function(){var e=this;$(e.$el).on("click",".ps_js-play_button",function(){$.isFunction(a)&&a(),0!==parseInt($(e.$el).attr("data-auto-close"))&&i.modal.close(o)}),n.store.store_update(o,{is_mounted:!0})},methods:{events:function(){var e=this;if(e.has_video){var t=$(e.$el).find(".ps_js-media_youtube");t.trigger("media_is_playing",function(t){e.is_video_playing=t}),t.on("media_ended media_stopped media_error",function(t){e.is_video_ended=1});$(e.$el).find(".ps_js-carousel_root").on("carousel_moved",function(){t.trigger("media_stop")})}}}})},bind:{show:function(){n.store.store_update(o,{slide_active:0})},shown:function(){n.store.store_update(o,{is_shown:!0,is_hide:!1})},hide:function(){n.store.store_update(o,{is_hide:!0,slide_active:1})},hidden:function(){n.store.store_update(o,{is_hide:!0,slide_active:1})}},onrender:function(){n.store.store_update(o,{is_rendered:!0})}})},running_game_modal:function(t,a){var n=s.has_running_error(),o="running_game"+r.gameName_as_key(t.runningGame)+r.gameName_as_key(t.gameName);i.modal.open(o,{modal_class:"running_notice_root",header:n.title,body:ps_helper.render_directives(t,n.content),footer:function(t){e.render(t,"running_modal_footer",{replace:!1,mounted:function(){var e=this,t=$(e.$el);t.find(".ps_js-running_game_continue").on("click",function(){$.isFunction(a)&&a(),i.modal.close(o)}),t.find(".ps_js-running_game_cancel").on("click",function(){i.modal.close(o)})}})}})}};return{games_template_thumbnail:function(){return{props:{productId:{},liveSearch:{default:!1},gameTypeFilter:{default:!1}},data:function(){return{is_loading:!0,is_success:!1,filter:null,search:"",last_filters:{},hovered_images:[],selected_game_type:"",games_raw:{rows:[],is_success:!1,err_code:null}}},computed:{games:function(){var e=this;if($.isPlainObject(e.games_raw)&&$.isArray(e.games_raw.rows)){var t={total:e.games_raw.rows.length};return ps_helper.assoc_merge(t,e.games_raw)}return{rows:[],is_success:!1,err_code:s.net_err_code,total:0}},game_keys:function(){var e=this,t=[];return e.games.rows.forEach(function(e,s){t.push(r.gameName_as_key(e.gameName))}),t},is_searched:function(){var e=this,t=[];return e.games.rows.forEach(function(s,i){t[i]=e.is_searched_filter(s)}),t},is_filtered:function(){var e=this,t=[];return e.games.rows.forEach(function(s,i){"new"==e.filter?t[i]=1==s.isNew:t[i]=!0}),t},is_hovered:function(){var e=this,t=[];return e.games.rows.forEach(function(s,i){t[i]=ps_helper.in_array(i,e.hovered_images)}),t},total:function(){var e=this;if(!1===e.is_loading){var t=0;return e.games.rows.forEach(function(s,i){e.is_searched[i]&&t++}),t}return null},is_display_result:function(){return null!==this.total},games_by_gameID:function(){var e=this,t={};return e.games.rows.forEach(function(e){t[e.gameID]=e}),t},game_type_filters:function(){var e=this,t=[];return 1==e.gameTypeFilter&&e.games.rows.forEach(function(e){ps_helper.in_array(e.type,t)||t.push(e.type)}),t},display_game_type:function(){return this.game_type_filters.length>1},filters:function(){var e=this;return{search:e.search,selected_game_type:e.selected_game_type}}},watch:{filters:function(){var e=this;e.total>0&&(e.last_filters=e.filters)}},mounted:function(){var e=this;e.load(),$(e.$el).on("games_template_reload",function(){0==e.is_loading&&0==e.games.is_success?e.load():($(e.$el).find(".ps_js-games_template_form").trigger("view_components_fullreset"),e.search="",e.selected_game_type="")}),$(e.$el).on("click",".ps_js-game_type_item",function(){if(e.display_game_type){var t=$(this).attr("data-game-type");e.selected_game_type==t?e.selected_game_type="":e.selected_game_type=t}})},methods:{is_searched_filter:function(e){var t=this;if(!ps_helper.empty(t.search)){if(!ps_helper.is_contain(t.search.toLowerCase(),e.gameName.toLowerCase()))return!1}return!(!ps_helper.empty(t.selected_game_type)&&e.type!=t.selected_game_type)},load:function(){var e=this;e.is_loading=!0,t.get_games(e.productId,{success:function(t){e.games_raw=t},fail:function(t){e.games_raw=t},error:function(t){e.games_raw=t},complete:function(){e.is_loading=!1,e.games.is_success&&e.$nextTick(function(){e.form_init()})}})},onerror:function(e,t){var s=this;switch(t.dcode){case"HRG":r.running_game_modal(t,function(){s.play(t._GID,t.runningGame)});break;case"DNR":require(["ps_displayname"],function(t){t.open(function(){s.play(e)})})}},form_init:function(){var e=this,t=$(e.$el).find(".ps_js-games_template_switch");e.filter=t.find(".ps_js-switch_value").val(),t.off("view_components_change").on("view_components_change",function(t,s){e.filter=s});var s=$(e.$el).find(".ps_js-games_template_form");s.off("submit").on("submit",function(t){t.preventDefault(),e.search=s.find(".ps_js-search_game").val()}),$(e.$el).find(".ps_js-games_template_back").off("click").on("click",function(){s.find(".ps_js-search_game").val(e.last_filters.search),s.trigger("submit"),e.selected_game_type=e.last_filters.selected_game_type}),$(e.$el).find(".ps_js-game_item").off("mouseover touchstart").on("mouseover touchstart",function(){var t=parseInt($(this).attr("data-index"));ps_helper.in_array(t,e.hovered_images)||e.hovered_images.push(t)}),$(e.$el).find(".ps_js-play_button").off("click").on("click",function(){e.play($(this).attr("data-gid"))}),$(e.$el).find(".ps_js-game_modal_trigger").off("click").on("click",function(){var t=parseInt($(this).attr("data-index")),s=e.games.rows[t];r.game_preview_modal(s,e.game_keys[t],function(){e.play(s.gameID)})}),e.liveSearch&&$(e.$el).find(".ps_js-search_game").off("keyup").on("keyup",function(){ps_helper.event_delay(function(){s.trigger("submit")},600,ps_helper.uniqid())})},play:function(e,a){var n=this;ps_helper.empty(a)&&(a=n.games_by_gameID[e].gameName),!1===ps_helper.is_ios()&&i.toast.open(a,{title:s.get("messages.opening_game"),type:"schedule",id:n.productId}),$(n.$el).trigger("games_template_clicked",e),t.play(e,n.productId,{success:function(t){$(n.$el).trigger("games_template_success",[e,t])},fail:function(t){$(n.$el).trigger("games_template_error",[e,t]),n.onerror(e,t)},complete:function(){0==ps_helper.is_ios()&&i.toast.close(n.productId)}})}}}},games_template_error:function(){return{props:["code"]}},games_template_play:function(){return{props:["game"]}}}});