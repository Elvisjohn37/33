define("ps_report",["ps_store","ps_view","ps_model","ps_helper","ps_window","ps_popup"],function(){var t=arguments[0],e=arguments[1],n=arguments[2],a=arguments[3],i=arguments[4],s=arguments[5],o={is_page_rendered:!1,store:new t("ps_report")},r={report_page_info:function(){return o.store.store_exists("info")||o.store.store_update("info",{loaded_hash:[],statement_selected:null,statement_loading:!0,statement_row:null,statement_refresh:!0,transfer_loading:!0,transfer_page:null,transfer_subtype:null,betting_loading:!0,betting_page:null,betting_subtype:null,credit_loading:!0,credit_page:null,credit_subtype:null,running_bets_loading:!0,running_bets_page:null,transaction_logs_loading:!0,transaction_logs_page:null,transaction_logs_form:{},transaction_logs_prev:!0,transaction_logs_next:!0}),o.store.store_fetch("info")},page_init:function(){var t=this;n.view_data({success:function(e){if("ingame"==e.route.view_type){var a=$(t.$el).attr("data-ingame-width"),i=$(t.$el).attr("data-ingame-height");window.resizeTo(a,i)}t.view_data=e,n.update_page_rendered(t.hash_info.page),t.is_init=!0}},["navigation","report","route"])},active_hash_change:function(t,e){var n=this,i=!a.in_array(t,n.page_info.loaded_hash),s=function(){var s=a.replace_all(e,"#",""),o=r[s];$.isPlainObject(o)&&$.isFunction(o.deactivate)&&o.deactivate.call(n);var _=a.replace_all(t,"#",""),c=r[_];$.isPlainObject(c)&&$.isFunction(c.activate)&&c.activate.call(n,i)};i?(o.store.store_list_push("info","loaded_hash",t),n.$nextTick(function(){s()})):s()},statement:{activate:function(t){var e=this;t&&($(e.$el).on("click",".ps_js-statement_dates",function(){r.statement.load(e,parseInt($(this).attr("data-number")))}),$(e.$el).on("change",".ps_js-statement_input",function(){r.statement.load(e,parseInt($(this).val()))}),$(e.$el).on("click",".ps_js-statement_drill_down",function(){o.store.store_update("info","statement_row",parseInt($(this).attr("data-row")))})),e.page_info.statement_refresh?r.statement.load(e,1):o.store.store_update("info","statement_refresh",!0)},load:function(t,e){o.store.store_update("info",{statement_selected:e,statement_loading:!0}),n.get_statement(e,{success:function(e){t.statement=e},complete:function(){o.store.store_update("info",{statement_loading:!1})}})}},statement_transfer_details:{activate:function(t){var e=this;if(t){$(e.$el).on("view_components_paging",".ps_js-transfer_table",function(t,n){o.store.store_update("info","transfer_page",n),r.statement_details(e,"Transfer")}),$(e.$el).find(".ps_js-transfer_refresh").on("click",function(){o.store.store_update("info","transfer_page",1),r.statement_details(e,"Transfer")});var n=a.array_last(e.view_data.navigation.hashes[e.active_main_hash].parents);$(e.$el).find(".ps_js-statement_back").on("click",function(){o.store.store_update("info","statement_refresh",!1),window.location=n.hash})}if(!a.empty(e.page_info.statement_row)){var i=e.statement.rows[e.page_info.statement_row];"Transfer"===i.type&&(o.store.store_update("info",{transfer_transactionID:i.transactionID,transfer_date:i.date,transfer_subtype:i.type,transfer_page:1}),r.statement_details(e,i.type))}if(a.empty(e.page_info.transfer_transactionID)){var n=a.array_last(e.view_data.navigation.hashes[e.active_main_hash].parents);window.location=n.hash}}},statement_credit_details:{activate:function(t){var e=this;if(t){$(e.$el).on("view_components_paging",".ps_js-credit_table",function(t,n){o.store.store_update("info","credit_page",n),r.statement_details(e,"Credit")}),$(e.$el).find(".ps_js-credit_refresh").on("click",function(){o.store.store_update("info","credit_page",1),r.statement_details(e,"Credit")});var n=a.array_last(e.view_data.navigation.hashes[e.active_main_hash].parents);$(e.$el).find(".ps_js-statement_back").on("click",function(){o.store.store_update("info","statement_refresh",!1),window.location=n.hash})}if(!a.empty(e.page_info.statement_row)){var i=e.statement.rows[e.page_info.statement_row];"Credit"===i.type&&(o.store.store_update("info",{credit_transactionID:i.transactionID,credit_date:i.date,credit_subtype:i.type,credit_page:1}),r.statement_details(e,i.type))}if(a.empty(e.page_info.credit_transactionID)){var n=a.array_last(e.view_data.navigation.hashes[e.active_main_hash].parents);window.location=n.hash}}},statement_betting_details:{activate:function(t){var e=this;if(t){$(e.$el).on("view_components_paging",".ps_js-betting_table",function(t,n){o.store.store_update("info","betting_page",n),r.statement_details(e,"Betting")}),$(e.$el).on("view_components_loaded",".ps_js-betting_table",function(){r.render_bet_links(e.betting.rows)}),$(e.$el).find(".ps_js-betting_refresh").on("click",function(){o.store.store_update("info","betting_page",1),r.statement_details(e,"Betting")});var n=a.array_last(e.view_data.navigation.hashes[e.active_main_hash].parents);$(e.$el).find(".ps_js-statement_back").on("click",function(){o.store.store_update("info","statement_refresh",!1),window.location=n.hash})}if(!a.empty(e.page_info.statement_row)){var i=e.statement.rows[e.page_info.statement_row];"Transfer"!=i.type&&"Credit"!=i.type&&(o.store.store_update("info",{betting_transactionID:i.transactionID,betting_subtype:i.type,betting_product:i.product,betting_page:1}),r.statement_details(e,"Betting"))}if(a.empty(e.page_info.betting_transactionID)){var n=a.array_last(e.view_data.navigation.hashes[e.active_main_hash].parents);window.location=n.hash}}},running_bets:{activate:function(t){var e=this;t&&($(e.$el).on("view_components_paging",".ps_js-running_bets_table",function(t,n){r.running_bets.load(e,n)}),$(e.$el).on("view_components_loaded",".ps_js-running_bets_table",function(){r.render_bet_links(e.running_bets.rows)}),$(e.$el).find(".ps_js-running_bets_refresh").on("click",function(){r.running_bets.load(e,1)})),r.running_bets.load(e,1)},load:function(t,e){o.store.store_update("info",{running_bets_page:e,running_bets_loading:!0}),n.get_running_bets(e,{success:function(e){t.running_bets=e},complete:function(){o.store.store_update("info",{running_bets_loading:!1})}})}},render_bet_links:function(){var t=null;return i.new_instance(function(a){return function(i){i.forEach(function(i){i.hasBetLink&&e.render($("#"+i.betLinkID),"report_bet_link",{data:{transDetID:i.transDetID},mounted:function(){var e=this;$(e.$el).on("click",function(){s.toast.open(ps_language.get("messages.loading_message"),{title:ps_language.get("messages.opening_bet_details"),type:"schedule",id:"bet_details"}),a.open("","width=800, height=717"),t=e.transDetID,n.bet_details(e.transDetID,{success:function(n){e.transDetID===t&&($.isPlainObject(n.window_size)&&a.resize(n.window_size.width,n.window_size.height),a.redirect(n.url))},fail:function(){e.transDetID===t&&a.close()},error:function(){e.transDetID===t&&a.close()},complete:function(){e.transDetID===t&&s.toast.close("bet_details")}})})}})})}})}(),statement_details:function(t,e){var a=e.toLowerCase();o.store.store_update("info",a+"_loading",!0),n.get_statement_details(e,{transactionID:t.page_info[a+"_transactionID"],page:t.page_info[a+"_page"],subtype:t.page_info[a+"_subtype"]},{success:function(e){t[a]=e},complete:function(){o.store.store_update("info",a+"_loading",!1)}})},transaction_logs:{activate:function(t){var e=this,n=$(e.$el).find(".ps_js-transaction_logs_form"),i=$(e.$el).find(".ps_js-transaction_logs_date");if(t){var s=$(e.$el).find(".ps_js-transaction_logs_table");s.on("view_components_paging",function(t,e){n.trigger("submit",e)}),s.on("view_components_loaded",function(){r.render_bet_links(e.transaction_logs.rows)}),n.on("submit",function(t,i){t.preventDefault(),i=i||1,o.store.store_update("info",{transaction_logs_form:a.json_serialize(n)}),r.transaction_logs.load(e,i)}),$(e.$el).find(".ps_js-transaction_logs_previous").on("click",function(){i.one("view_components_change",function(t,e){n.trigger("submit")}),i.trigger("view_components_previous","hour")}),$(e.$el).find(".ps_js-transaction_logs_next").on("click",function(){i.one("view_components_change",function(t,e){n.trigger("submit")}),i.trigger("view_components_next","hour")}),i.on("view_components_available",function(t,e){"hour"==e.type&&"prev"==e.arrow&&o.store.store_update("info","transaction_logs_prev",e.available),"hour"==e.type&&"next"==e.arrow&&o.store.store_update("info","transaction_logs_next",e.available)}),i.trigger("view_components_availability","hour")}n.trigger("view_components_fullreset"),i.one("view_components_change",function(t,e){n.trigger("submit")})},load:function(t,e){o.store.store_update("info",{transaction_logs_page:e,transaction_logs_loading:!0}),n.get_transaction_logs(t.page_info.transaction_logs_form,e,{success:function(e){t.transaction_logs=e},complete:function(){o.store.store_update("info","transaction_logs_loading",!1)}})}}};return{activate:function(t,n){var i=r.report_page_info();o.is_page_rendered||(o.is_page_rendered=!0,e.render($(".ps_js-page_"+n.page),"report",{replace:!1,data:{hash_info:n,page_info:i,view_data:{},is_init:!1,statement:{rows:[],footer:{},total:0},transfer:{rows:[],total:0},betting:{rows:[],total:0},credit:{rows:[],total:0},running_bets:{rows:[],total:0,total_running_bet:null},transaction_logs:{rows:[],total:0,hasNext:!1}},computed:{page_navigation_data:function(){return this.view_data.navigation.pages[this.hash_info.page]},active_main_hash:function(){var t=this;return t.is_init?t.page_navigation_data.active_main_hash:""},statement_length:function(){return this.statement.rows.length},transfer_length:function(){return this.transfer.rows.length},betting_length:function(){return this.betting.rows.length},credit_length:function(){return this.credit.rows.length},running_bets_length:function(){return this.running_bets.rows.length},transaction_logs_length:function(){return this.transaction_logs.rows.length},transaction_final_prev:function(){var t=this,e=t.page_info.transaction_logs_prev,n=t.page_info.transaction_logs_loading;return e&&!n},transaction_final_next:function(){var t=this,e=t.page_info.transaction_logs_next,n=t.page_info.transaction_logs_loading;return e&&!n},enabled_dates:function(){var t=this;if($.isPlainObject(t.view_data.report)){var e={},n=[];return t.view_data.report.statement_dates.forEach(function(t){var i=parseInt(t.year),s=parseInt(t.month);$.isArray(e[i])||(e[i]=[]),a.in_array(s,e[i])||e[i].push(s),a.in_array(i,n)||n.push(i)}),{months:e,years:n}}return{months:null,years:null}}},watch:{active_main_hash:r.active_hash_change},mounted:r.page_init}))}}});