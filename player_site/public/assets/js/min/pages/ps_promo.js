define("ps_promo",["ps_view","ps_model","ps_language","ps_popup","ps_store"],function(){"use strict";var o=arguments[0],e=arguments[1],r=arguments[2],s=arguments[3],i=arguments[4],t={is_page_rendered:!1,store:new i("ps_promo")},n={load:function(o){o.is_loading=!0,e.get_promo({success:function(e){o.promo_raw=e,o.is_success=!0},fail:function(e){o.promo_raw=e,o.is_success=!1},error:function(e){o.promo_raw=e,o.is_success=!1},complete:function(){o.is_loading=!1,o.is_success&&o.$nextTick(function(){n.form_events(o)})}})},form_events:function(o){var e=$(o.$el).find(".ps_js-promo_switch");o.filter=e.find(".ps_js-switch_value").val(),e.off("view_components_change").on("view_components_change",function(e,r){o.filter=r});var r=$(o.$el).find(".ps_js-promo_form");r.off("submit").on("submit",function(e){e.preventDefault(),o.search=r.find(".ps_js-search_promo").val().toLowerCase()}),$(o.$el).find(".ps_js-promo_back").off("click").on("click",function(){r.find(".ps_js-search_promo").val(o.last_search),r.trigger("submit")}),$(o.$el).find(".ps_js-promo_trigger").off("click").on("click",function(){n.promo_modal($(this).attr("data-index"),o.promo.rows[$(this).attr("data-index")])})},promo_modal:function(e,r){var i="promo_"+e,_=n.modal_info(i),a="ps_js-"+i;s.modal.open(i,{modal_class:"promo_root "+a,header:r.title,body:function(e){o.render(e,"promo_modal",{replace:!1,data:{promo:r,modal_info:_,is_sticky_image:!1,custom_class:a},computed:{has_video:function(){var o=this;return!ps_helper.empty(o.promo.videoSource)},is_loaded:function(){var o=this,e=o.modal_info.is_shown,r=o.modal_info.is_rendered,s=o.modal_info.is_mounted;return e&&r&&s},load_video:function(){var o=this;return o.has_video&&o.is_loaded},is_video_stop:function(){var o=this;return o.modal_info.is_hide&&o.has_video}},watch:{is_video_stop:function(o){var e=this,r=$(e.$el).find(".ps_js-media_youtube");o&&r.trigger("media_stop")}},mounted:function(){t.store.store_update(i,{is_mounted:!0})}})},bind:{shown:function(){t.store.store_update(i,{is_shown:!0,is_hide:!1})},hide:function(){t.store.store_update(i,{is_hide:!0})}},onrender:function(){t.store.store_update(i,{is_rendered:!0})}})},modal_info:function(o){return t.store.store_exists(o)||t.store.store_update(o,{is_shown:!1,is_rendered:!1,is_mounted:!1,is_hide:!1}),t.store.store_fetch(o)}};return{activate:function(s,i){var _=$(".ps_js-page_"+i.page);0==t.is_page_rendered?(t.is_page_rendered=!0,o.render(_,"promo",{replace:!1,data:{hash_info:i,filter:null,search:"",last_search:"",is_loading:!0,is_success:!1,err_code:null,promo_raw:{rows:[],total:0}},computed:{promo:function(){var o=this;return $.isPlainObject(o.promo_raw)&&$.isArray(o.promo_raw.rows)?o.promo_raw:{rows:[],is_success:!1,err_code:r.net_err_code}},is_searched:function(){var o=this,e=[];return o.promo.rows.forEach(function(r,s){ps_helper.empty(o.search)?e[s]=!0:e[s]=ps_helper.is_contain(o.search,r.title.toLowerCase())}),e},is_filtered:function(){var o=this,e=[];return o.promo.rows.forEach(function(r,s){"new"==o.filter?e[s]=1==r.derived_isNew:e[s]=!0}),e},total:function(){var o=this;if(!1===o.is_loading){var e=0;return o.promo.rows.forEach(function(r,s){o.is_searched[s]&&e++}),e}return null},is_display_result:function(){return null!==this.total}},watch:{search:function(){var o=this;o.total>0&&(o.last_search=o.search)}},mounted:function(){var o=this;e.update_page_rendered(o.hash_info.page),n.load(o),$(o.$el).on("promo_template_reload",function(){0==o.is_loading&&0==o.is_success?n.load(o):($(o.$el).find(".ps_js-promo_form").trigger("view_components_fullreset"),o.search="")})}})):_.find(".ps_js-promo").trigger("promo_template_reload")}}});