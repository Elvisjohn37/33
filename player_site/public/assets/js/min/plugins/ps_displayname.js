define("ps_displayname",["jquery","ps_helper","ps_popup","ps_language","ps_view","ps_validator","ps_model","ps_store"],function(){$=arguments[0],ps_helper=arguments[1],ps_popup=arguments[2],ps_language=arguments[3],ps_view=arguments[4],ps_validator=arguments[5],ps_model=arguments[6],ps_store=arguments[7];var e={debug:!0,store:new ps_store("ps_displayname"),onset_hide_function:null},s={debug:ps_helper.debug(e.debug),modal_store:function(){return e.store.store_exists("modal_info")||e.store.store_update("modal_info",{status:"start",loading:!1,isset:!1}),e.store.store_fetch("modal_info")},modal_init:function(){var t=this,o=$(t.$el).find(".ps_js-displayname_form");o.find(".ps_js-displayname_input");ps_validator.apply(o,{validations:{".ps_js-displayname_input":{triggers:"blur change keyup paste",prevent:!0,validate:[{as:"displayName",exclude_triggers:["prevent"]},{as:"alpha_num",type:"displayName"},{as:"max_length",type:"displayName"}]}},success:function(){s.set(o)},failed:function(){e.store.store_update("modal_info",{status:"error"})}}),o.on("reset",function(){e.store.store_update("modal_info",{status:"start"})}),o.find(".ps_js-displayname_input").on("blur change keyup paste",function(){var s=$(this);ps_helper.event_delay(function(){ps_helper.empty(s.val())?e.store.store_update("modal_info",{status:"start"}):s.hasClass("ps_js-input_error")?e.store.store_update("modal_info",{status:"error"}):ps_model.validate_displayName(s.val(),{success:function(){e.store.store_update("modal_info",{status:"success"})},fail:function(){e.store.store_update("modal_info",{status:"error"})}})})})},modal_button_events:function(){var e=this;$(e.$el).find(".ps_js-displayname_ignore").on("click",function(){s.ignore()}),$(e.$el).find(".ps_js-displayname_submit").on("click",function(){e.disable_submit||$(this).closest(".ps_js-modal_displayname").find(".ps_js-displayname_form").trigger("submit")})},modal_footer_computed:function(){return{disable_submit:function(){return"success"!=this.info.status||this.info.loading},can_ignore:function(){return 0==this.view_data.user.displayNameStatus}}},ignore:function(){e.store.store_update("modal_info",{loading:!0}),ps_model.generate_displayName({success:function(){e.store.store_update("modal_info",{isset:!0}),ps_popup.modal.close("displayname")},complete:function(){e.store.store_update("modal_info",{loading:!1})}})},set:function(s){e.store.store_update("modal_info",{loading:!0}),ps_model.change_displayName(ps_helper.json_serialize(s),{success:function(){e.store.store_update("modal_info",{isset:!0}),ps_popup.modal.close("displayname")},complete:function(){e.store.store_update("modal_info",{loading:!1})}})}};return{open:function(t){var o=s.modal_store();e.onset_hide_function=t,ps_popup.modal.open("displayname",{modal_class:"displayname_modal_root",header:ps_language.get("language.set_display_name"),body:function(e){ps_view.render(e,"displayname_modal",{replace:!1,data:o,mounted:s.modal_init})},footer:function(e){ps_model.view_data({success:function(t){ps_view.render(e,"displayname_modal_footer",{data:{info:o,view_data:t},computed:s.modal_footer_computed(),replace:!1,mounted:s.modal_button_events})}},["user"])},bind:{shown:function(){ps_helper.ready(".ps_js-displayname_form",function(){$(this).trigger("view_components_fullreset")},$(this)),ps_helper.ready(".ps_js-displayname_input:visible",function(){$(this).trigger("focus")},$(this))},hide:function(){o.isset&&$.isFunction(e.onset_hide_function)&&e.onset_hide_function(),e.onset_hide_function=null}}})}}});